<!doctype html>
<html lang="en">
  <head>
    <title>CHART</title>
    <style>
      section{
        background:url("nightsky.jpeg") no-repeat center fixed;
      }
      </style>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<!--my css code. -->
    <link rel="stylesheet" href="index.css" type="text/css">

  </head>
<!--I am also having a hard time spreading the nav bar equally spaced (maybe use an id)
I also can't get the drop down menu to work-->
<header id="mainmenu">
  <nav class="navbar navbar-expand-lg nav-justified" style="background:black;">
    <div>
  <a class="navbar-brand text-white" href="../index.html"> </a> </div>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse justify-content-center nav-fill" id="navbarSupportedContent">
    <ul class="nav navbar-nav nav-fill" class= ".active">
      <li class="active">
        <a class="nav-link text-white" href="../index.html">Home<span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="about.html">About</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Tutorials
          </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item text-black" href="website/hardware.html">Telescope Design</a>
            <a class="dropdown-item text-black" href="website/software.html">Software Setup</a>
            <a class="dropdown-item text-black" href="website/datataking.html">Taking data</a>
            <a class="dropdown-item text-black" href="website/analysis.html">Analysis</a>
      
        </div>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="faq.html">FAQ</a> </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="contact.html">Contact</a> </li>
        </ul>
</div>
</div>
</nav>
<h2 id="centerheader" style= "border:solid;border-color:black;" font-family:"courier new", courier, arial; >Software</h2>
</header>

    <body>

  <div>
    <ul class="sidenav" style="text-align:left;color:white;border-bottom-left-radius:5px;border-bottom-right-radius:5px;">
  <li> <a href="#firstdata">Take Your First Radio Data</a> </li>
  <li>  <a href="#spectrum">Create a Spectrum Flowchart and Save the Data</a> </li>
  <li> <a href="#datasize">Is our Data Size Correct?</a> </li>
  <li> <a href="#package">Data taking with CHART installed package</a> </li>
  </ul>
  </div>

  <div id="top_pad"></div>


    <hr class="boldline">

      <a class="anchor" id="firstdata"></a>
      <h2 style="text-align:left;">Take your first radio data</h2>

    Open up your newly installed GNU Radio by typing in this command in the terminal:
         <br><span class="commandline">gnuradio-companion</span></br>
      Please visit this link to learn some background info on the blocks we are going to use in GNU Radio:
      [link]
      1.  After gnuradio opens, make a simple flow chart by locating the RTL-SDR Source block and QT GUI Sink block and connecting them together. You can connect them by clicking on one black and then clicking on the other block right after.
      <br><span class="boldfont">Finding RTL-SDR Block</span></br>
<img src="https://astrochart.github.io/website/tutorials/firstdata1.png" class="left" alt="RTL_SDR Block" style="height:200px;border-radius:5px;"></br>
<br><span class="boldfont">Finding Sink Block</span></br>
 <img src="https://astrochart.github.io/website/tutorials/firstdata2.png" class="left" alt="GUI Sink Block" style="height:250px;border-radius:5px;">
 <br><span class="boldfont">Connecting the blocks to eachother so that they can interact with eachother.</span></br>
  <img src="https://astrochart.github.io/website/tutorials/firstdata3.png" class="left" alt="Connecting the Blocks" style="height:430px;border-radius:5px;">

    <br>  I also modified my default Variable box to a Value: 1M, but this is only a personal preference. </br>
<br>2.Connect radio antenna source to the RTL-SDR input so that we can see real radio data in our program. Make sure to elongate the antennas fully so that you can receive a strong radio signal. </br>
<br><span class="boldfont">How the Hardware Setup Should Look. </span></br>
<img src="https://astrochart.github.io/website/tutorials/firstdata4.JPG" class="left" alt="Antenna set Up" style="height:450px;border-radius:5px;"></br>
<br>3. Click the “Generate the flow graph” button, to transform our flow chart into python code. Next click the “Execute the flow graph button” to create a real time data plot of the incoming radio signals.</br>
<br><span class="boldfont">Where to Find the "Execute" "Generate" Flow Graph Buttons.</span></br>
  <img src="https://astrochart.github.io/website/tutorials/firstdata5.png" class="left" alt="Genterate the Flow Graph" style="height:350px;border-radius:5px;"></br>
  <br>4. A new window will pop up that displays incoming radio data. You can click on the tabs at the top of the screen to view the data in “Frequency”, “Waterfall”, “Time Domain”, or “Constellation” display.</br>
  <br><span class="boldfont">This is the data that we collected.</span></br>
<img src="https://astrochart.github.io/website/tutorials/firstdata6.png" class="left" alt="First Data Set" style="height:400px;border-radius:5px;"></br>
Congratulations, you have collected your first radio data set!

      <hr class="boldline">

        <a class="anchor" id="spectrum"></a>
        <h2 style="text-align:left;">Create a Spectrum Flowchart and Save the Data</h2>

        Now that you've familiarized yourself with gnuradio, it's time to create a more complex flowchart.
        The goal of this flowchart is to create a spectrum estimator, which will help us observe what frequencies
        that our radios can record. The final part of this lesson goes over how to save and locate your recorded data.

        <hr class="thinline">

    1. Start off with creating a new flowchart.
<br><img src="https://astrochart.github.io/website/tutorials/flow1.png" class="left" alt="First Data Set" style="height:300px;border-radius:5px;"></br>

      <br>2. Open the Options block by double clicking it. <p>Select 'No GUI' for 'Generate Options' and select 'Run to Completion' for the 'Run Options'.
<img src="https://astrochart.github.io/website/tutorials/flow2.png" class="left" alt="First Data Set" style="height:400px;border-radius:5px;"></br>

    <br>  3.  In the premade variable block, double click to open it. <p>Rename the ID 'samp_rate' and set the value to 2e6 (2 million).</p>
      Press ‘apply’ and ‘OK’ to close the box.
<br><img src="https://astrochart.github.io/website/tutorials/flow3.png" class="left" alt="First Data Set" style="height:220px;border-radius:5px;"></br>

<br>4. Add the 'RTL-Source' block. You can do this by locating it through the search bar and either double clicking on it, or by dragging it to the other side of the screen. Double click on the ‘RTL-Source’ block and change the 'RF Gain' to '45' (you might have to scroll down to see this option). Also, set the 'Sample Rate' to 'samp_rate'. Click ‘apply’ and ‘OK’.

<img src="https://astrochart.github.io/website/tutorials/flow4_0.png" class="left" alt="First Data Set" style="height:600px;border-radius:5px;"></br>

<br><img src="https://astrochart.github.io/website/tutorials/flow4_1.png" class="left" alt="First Data Set" style="height:350px;border-radius:5px;"></br>

<br>5. Create a variable block and name it 'veclength'. Make the value '1024'. click ‘apply’ and ‘OK’.

<img src="https://astrochart.github.io/website/tutorials/flow5.png" class="left" alt="First Data Set" style="height:320px;border-radius:5px;"></br>

<br>6. Add a 'Head' block. This block will limit the amount of data that will be processed. Set 'Num Items' to '10240000'. Click ‘apply’ and ‘OK’. Connect the head block to the 'RTL-Source' block by clicking on the little blue box that reads ‘out’ on the “RTL-SDR Source” box and ‘in’ on the “Head” box. Click on the white screen and arrow should appear connecting the two.<br>

<img src="https://astrochart.github.io/website/tutorials/flow6_0.png" class="left" alt="First Data Set" style="height:250px;border-radius:5px;"></br>

<br><img src="https://astrochart.github.io/website/tutorials/flow6_1.png" class="left" alt="First Data Set" style="height:400px;border-radius:5px;"></br>

<br>7. Add a 'Stream to Vector' block and set the 'Num Items' to 'veclength'. Click ‘apply’ and ‘OK’. Connect to 'Head' block.</p>
<br>8. Add an 'FFT' block. This will convert the data into a Fast Fourier Transform. Set the 'FFT size' to 'veclength'; click ‘apply’ and ‘OK’. Connect to the 'Stream to Vector' block.</p>

<br>9. Add a 'Complex to Mag^2' block and set ‘Vec Length’ to ‘veclength’. Click ‘apply’ and ‘OK’. This block makes all the data values real by squaring the complex numbers. Connect to 'FFT' block.</p>

<img src="https://astrochart.github.io/website/tutorials/flow7-9.png" class="left" alt="First Data Set" style="height:120px;border-radius:5px;"></br>

<br>10. Add an 'Integrate' block and set ‘Vec. Length' to 'veclength' and 'Decimation' to '100'. Change ‘IO Type’ to ‘Float’. You know the drill, click ‘apply’ and ‘OK’. This reduces the data size by averaging every 100 items into one item. Connect to 'Mag^2' block.

<br><img src="https://astrochart.github.io/website/tutorials/flow10.png" class="left" alt="First Data Set" style="height:400px;border-radius:5px;"></br>

<br>11. Finally, add a 'File Sink' block and set 'Vec Length' to 'veclength'. Then change ‘IO Type’ to ‘Float’. Specify where you want the file to be written in by clicking on the ‘three dots’ icon next to ‘file’. Click ‘apply’ and ‘OK’. This will write the data into a file on your computer.

<br><img src="https://astrochart.github.io/website/tutorials/flow11_0.png" class="left" alt="First Data Set" style="height:250px;border-radius:5px;"></br>

Here is how the final flowchart should look:

<img src="https://astrochart.github.io/website/tutorials/flow11_1.png" class="left" alt="First Data Set" style="height:300px;border-radius:5px;"></br>
<br>12. Generate your flow chart.

<br>13. Press the green play button to ‘Execute the flow graph’.

<img src="https://astrochart.github.io/website/tutorials/flow12.png" class="left" alt="First Data Set" style="height:300px;border-radius:5px;"></br>

<br>14. To double check if your data was written in the desired location, open up your terminal. You can use the following Linux commands to find the recorded data:
ls: directory listing; this will show you all of the contents/ folders in your current location          on the computer.

cd *space* [insert location]: change directory to [your desired location]; this relocates you 	to whatever location you type after cd *space* [insert location].

For example: I started by typing ls into my terminal and pressed enter. This will show me the contents of the place I’m located on my computer. If I don’t remember exactly where I put the saved data, but I know the way to find it, I then find a file that would help me navigate closer to my desired data using cd [the place I want to go]. For example here is the code I used to find my “Waterfall Tutorial” file that I used to download my data to:


*At the bottom you will see that once I located my file, I typed <span class="commandline">ls -lh</span> to see how big my file was. The fact that it is 400k (400 kilobytes) tells me that I have located my file. To see why this is, proceed to the next tutorial "Is Our Data Size Correct?"


<br><img src="https://astrochart.github.io/website/tutorials/flow14.png" class="left" alt="First Data Set" style="height:500px;border-radius:5px;"></br>




        <hr class="boldline">

          <a class="anchor" id="datasize"></a>
          <h2 style="text-align:left;">Is our Data Size Correct?</h2>
          Congratulations, you have created your first complete flowchart! Now, how do you know that the amount of data you collected was correct and that this experiment went according to plan? Let’s go through what each block does and how much data it takes in so that we can check that we did everything correctly.

          Before we start I want to make clarifications between some vocabulary I will be using in this section.
<hr class="thinline">
<p><span class="boldtext">Sample:</span> This is how much data is collected per second. In this tutorial we chose 2,000,000     or   2106. In each of our ‘samples’ we collect 2 numbers.
<p><span class="boldtext">Bit:</span> Short for “binary digit”. This is the smallest unit of data in a computer. A bit has a single binary value of 1 or 0.
<p><span class="boldtext">Byte:</span> Equal to 8 bits.
<p><span class="boldtext">Kilobyte (kB):</span> Equal to 1024 bytes. (Try not to get this confused with the normal 1000=kilo).
<p><span class="boldtext">Vector:</span> In this context a vector is how we will be organizing our data so that we can process it in a following step.
<p><span class="boldtext">Integers:</span> In binary, integers (whole numbers that aren’t a decimal or fraction) take up 32 bits worth of data.
<p><span class="boldtext">Complex 32:</span> *Need help on this*
<p><span class="boldtext">Float 32:</span> *Need help on this*
<hr class="thinline">

<span class="boldtext">RTL-SDR Source: </span>
This controls how much data we initially take in from the telescope itself. We set a parameter of 2 million samples per second. For each sample that we take, we get 2 numbers. For each number we use 32 bits of data. If we do a quick calculation we see that we are taking in 1.28108 bits per second.

<br><img src="https://astrochart.github.io/website/tutorials/size1.png" class="left" alt="Data Size" style="height:120px;border-radius:5px;"></br>

<span class="boldtext">Head:</span>
This block limits the total number of samples that will be collected, in this case 10,240,000 or 1.024107. From this, we can calculate how much time our total data collection should take.

<br><img src="https://astrochart.github.io/website/tutorials/size2.png" class="left" alt="Data Size" style="height:200px;border-radius:5px;"></br>

If your data collection took around this time, it’s another indicator that our data collection probably went smoothly.

<br><span class="boldtext">Stream to Vector: </span>
We usually call whatever is input and output of a block an “item”. This block takes 1024 samples (input as individual items), and outputs them as one item vector of 1024 samples. We do this because in order to complete the next task (fast Fourier transform) we need a certain amount of samples at a time to complete this calculation.
Here is what our item number looks like before and after our “stream to vector”:

<br><img src="https://astrochart.github.io/website/tutorials/size3.png" class="left" alt="Data Size" style="height:50px;border-radius:5px;"></br>

<br><span class="boldtext">FFT (Fast Fourier Transform):</span>
	This block takes our data and finally puts it into a form (sin and cos waves) that is useful for us to use. Each vector is considered a time with a certain frequency. This allows us to have a graph with axis of time and frequency.
  <span class="boldtext">Complex to Mag^2:</span>
  So far we have had two numbers per sample: a real and imaginary (complex) number. This block takes our real and complex numbers, squares each of them, and adds the values. This changes our input of a complex 32 to a float 32.

  <p>This implements the following function:
  (real number in)^2 + (complex number in)^2 = new single number real output
<br><img src="https://astrochart.github.io/website/tutorials/size4.png" class="left" alt="Data Size" style="height:70px;border-radius:5px;"></br>
Integrate:
This block reduces the data size by averaging every 100 values into one value. We can take out current bit value and divide by 100.
<br><img src="https://astrochart.github.io/website/tutorials/size5.png" class="left" alt="Data Size" style="height:200px;border-radius:5px;"></br>

According to our previous calculations, the program is supposed to run for 5.12 seconds, so we will multiply our bits per second by 5.12 seconds.
<br><img src="https://astrochart.github.io/website/tutorials/size6.png" class="left" alt="Data Size" style="height:150px;border-radius:5px;"></br>

We will now do a few conversions so that we can put this value into kilobits.
<p><span class="boldtext">Converting bits to bytes: </span>
<br><img src="https://astrochart.github.io/website/tutorials/size7.png" class="left" alt="Data Size" style="height:100px;border-radius:5px;"></br>

<p><span class="boldtext">Converting bytes to kilobytes: </span>
<br><img src="https://astrochart.github.io/website/tutorials/size8.png" class="left" alt="Data Size" style="height:100px;border-radius:5px;"></br>

<span class="boldtext">Congratulations, you completed this tutorial and proved that the amount of data you received is correct.</span>

  <a class="anchor" id="download"></a>
  <h2 style="text-align:left;">Take data with installable package</h2>
  <br>While using GNUradio can be a great way to understand how data taking works and allows you to look at your data in real time, another method to take and 
save data is by using the installable CHART package at 
<a href="https://github.com/astrochart/CHART"> the CHART github repository.</a> with installation instructions in the readme.md file. 
<br>
<p> Upon installing the package, the data taking process can be started from the daq folder, with the python script freq_and_time_scan.py. The approprtiate syntax 
is to type python freq_and_time_scan.py --arguement=value --arguement=value --etc
<br>
<p> Current arguements and their defaults are as follows:
	<br>

  <p>  argument('--scan_period', default=0.5, type=float, help='Time '
                    'between a scan and the next, in hours. Default is 0.5.')
  <br>  argument('--total_time', default=24., type=float,
                    help='Total time for all scans, in hours. Default is 24.')
  <br>  argument('--freq_i', default=50., type=float, help='Starting frequency, '
                    'in MHz. Default is 50.')
  <br>   argument('--freq_f', default=150., type=float, help='Ending frequency, '
                    'in MHz. Default is 150.')
  <br>  argument('--df', default=1., type=float, help='Frequency tuning step '
                    'size, in MHz. Default is 1.')
  <br>  argument('--sleep_time', default=5., type=float, help='Sleep time '
                    'between checks for next scan time, in seconds. Default is 5.')
  <br>  argument('--veclength', default=1024, type=int, help='Vector length '
                    '(number of channels) for spectrum estimation. Default is 1024.')
  <br>  argument('--samp_rate', default=2., type=float, help='Sample rate '
                    'of the radio, in MHz. Default is 2.')
  <br>  argument('--int_length', default=100, type=int, help='Number of samples '
                    'per integration. Default is 100.')
  <br>  argument('--int_time', type=float, help='Integration time, in seconds.'
                    ' Overrides the --int_length argument.')
  <br>  argument('--nint', default=100, type=int, help='Number of integrations '
                    'per file. Default is 100.')
  <br>  argument('--data_dir', default=None, type=str, help='Data directory. '
                    'Defaults to current working directory.')
<br>
<p> A reccomended example call for a simple 21cm observation as a test is as follows:
 <br> python freq_and_time_scan.py --scan_period=0.001 --total_time=0.001 --freq_i=1410. --freq_f=1430. --df=1. --sleep_time=5. --veclength=1024 --samp_rate=2 --int_length=100 --nint=500 --data_dir='path/to/directory/where/you/want/to/put/your/data'
   
   <hr class="thinline">


</div>
<div class="footer">
    This project is supported by a <a href="https://nsf.gov" target="_blank">National Science Foundation</a> Astronomy and Astrophysics Postdoctoral Fellowship under award <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1701440" target="_blank">AST-1701440</a>.
</div>
  </body>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</html>
